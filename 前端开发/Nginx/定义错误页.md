
当客户端在发送 HTTP 请求时，若服务器能够收到，则一定会返回数据。这样的数据中包含了服务器的响应头以及处理的结果数据等，当服务器无法处理客户端的请求时，也会返回数据，但是带有错误信息的响应。比如客户端所请求的页面不存在，则服务器返回的数据中会带有 404 的错误码，若在浏览器中没有将错误信息输出到页面，用户是无法直接看到网络请求是否成功，只能通过控制台的报错看到服务器返回的错误码是什么。

Nginx 能够识别错误码并处理在发生错误时所要展示的页面，当用户请求的页面不存在，当 Nginx 识别到错误码为 404 时，则会作出反应，将设置好的页面发送给客户端显示。即假设客户端要访问的是 index.html，若 Nginx 无法找到该文件，则会去把设置好的 404.html 返回给客户端。

当然错误不止 404 一个，下面列出了生产环境中常见的 HTTP 状态码：

- **200** 服务成功返回页面，这是成功的 http 请求
- **301** 永久跳转 permanent
- **302** 临时跳转 redirect
- **403** 禁止访问，这个请求是合法的，但是服务器端因为事先根据规则而拒绝了请求，一般是服务 器权限设置不正确。
- **404** 服务器找不到客户端所请求的页面
- **500** 服务器内部错误
- **502** 坏的网关，一般为代理服务器出现问题
- **503** 服务器当前不可用，可能因为服务器超载或者是维护所致
- **504** 网关超时

在 Nginx 配置文件中，通过 `error_page` 关键字设置错误页，且 `error_page` 需要设置在 `server` 配置块中。`error_page` 是一个设置在虚拟主机中的配置项。

## 定义一种类型的错误页

Nginx 支持单独对某一种类型指定一个错误页，通过错误码指定。

### 使用本地错误页

```shell
server {
	...
	
	# 当出现 403 错误时返回网站根目录下的 403.html。
	error_page 403 /403.html;
	
	# 当出现 404 错误时返回网站根目录下的 404.html。
	error_page 404 /404.jpg;
	
	...
}
```

前提是所设置的错误页要存在，否则设置不生效。

### 使用在线错误页

使用在线错误页会使当前的错误码变更为 302，实际上 Nginx 是通知了服务器通过重定向访问指定的在线页面。

```shell
server {
	...
	
	# 当出现 403 错误时返回 http://example.com 的 forbidden.html。
	error_page 403 http://example.com/forbidden.html;
	
	...
}
```

## 定义多个类型的错误页

定义多个类型即同时指定多个错误码，在配置文件中通过空格隔开。

```shell
server {
	...
	
	# 当出现 403 错误时返回网站根目录下的 50x.html。
	error_page 500 502 503 504 /50x.html;

	# 或

	# 当出现 404 错误时返回 http://example.com 的 50x.html。
	error_page 500 502 503 504 http://example.com/50x.html;
	
	...
}
```

## 更改响应状态码

在 Nginx 展示错误页时可以将状态码改变为指定状态码。当用户访问一个不存在的页面时，响应状态码为 404，Nginx 则根据设置返回指定的错误页，此时返回的响应状态码依然 404。通过设置更改响应状态码可以将其修改为 200，即成功。

更改响应状态码可用于隐藏服务器返回的真实状态码，这样有利于隐藏服务器上的资源，避免攻击者进一步掌握网站中的文件名或其他信息。

更改响应状态码通过在错误码后用 “=” 紧接变更状态码指定。配置方式如下：

```shell
server {
	...
	
	# 当出现 404 错误时，修改状态码为 200 并返回 404.html。
	error_page 404 =200 /404.html;
	
	...
}
```

![[Pasted image 20230414165736.png]]

需要注意的是 “=” 和变更状态码之间**不允许有空格**。

若 “=” 后不加变更状态码，则会将状态码修改为实际处理的结果。

```shell
server {
	...
	
	# 当出现 404 错误时，获取 404.html
	error_page 404 = /404.html;
	
	...
}
```

